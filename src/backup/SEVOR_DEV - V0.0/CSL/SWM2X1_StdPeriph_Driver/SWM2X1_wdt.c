/****************************************************************************************************************************************** 
* �ļ�����: SWM2X1_wdt.c
* ���  ˵��:	SWM2X1��Ƭ����WDT���Ź�����������
* ���  ֧��:	http://www.synwit.com.cn/e/tool/gbook/?bid=1
* ע������:
* �汾�  ��:	    .0.0		2016��1��30��
* ������¼:  
*
*
*******************************************************************************************************************************************
* @attention
*
* THE PRESENT FIRMWARE WHICH IS FOR GUIDANCE ONLY AIMS AT PROVIDING CUSTOMERS WITH CODING INFORMATION 
* REGARDING THEIR PRODUCTS IN ORDER FOR THEM TO SAVE TIME. AS A RESULT, SYNWIT SHALL NOT BE HELD LIABLE 
* FOR ANY DIRECT, INDIRECT OR CONSEQUENTIAL DAMAGES WITH RESPECT TO ANY CLAIMS ARISING FROM THE CONTENT 
* OF SUCH FIRMWARE AND/OR THE USE MADE BY CUSTOMERS OF THE CODING INFORMATION CONTAINED HEREIN IN CONN-
* -ECTION WITH THEIR PRODUCTS.
*
* COPYRIGHT 2012 Synwit Technology
*******************************************************************************************************************************************/
#include "SWM2X1.h"
#include "SWM2X1_wdt.h"


/****************************************************************************************************************************************** 
* ���  ����:	WDT_Init()
* ���  ˵��:	WDT���Ź���ʼ��
* ��    ��: WDT_TypeDe    * WDTx		ָ��Ҫ�����õĿ��Ź�����Чֵ����WDT
*      uint32_t int_period    �ж����ڣ�ȡֵ1--65534����λ1/1000�룬ȡֵ0��ʾ�ر�WDT�жϹ���
*      uint32_t rst_period    ��λ���ڣ�ȡֵ1--65534����λ1/1000�룬ȡֵ0��ʾ�ر�WDT��λ����
* ��    ��: ��
* ע������: ��
******************************************************************************************************************************************/
void WDT_Init(WDT_TypeDef * WDTx, uint32_t int_period, uint32_t rst_period)
{
  SYS->CLKEN0 |= (1 << SYS_CLKEN0_WDT_Pos);
  
  SYS->CLKSEL &= ~SYS_CLKSEL_WDT_Msk;
  SYS->CLKSEL |= (2 << SYS_CLKSEL_WDT_Pos);  //Ƭ��32k��ΪWDT����ʱ��Դ
  
  WDT_Stop(WDTx);    //����ǰ�ȹر�
  
  WDTx->CR &= ~WDT_CR_CLKDIV_Msk;
  WDTx->CR |= (4 << WDT_CR_CLKDIV_Pos);    //ʱ��32��Ƶ
  
  if(int_period == 0)
  {
    WDTx->CR &= ~(1 << WDT_CR_INTEN_Pos);
    
    NVIC_DisableIRQ(WDT_IRQn);
  }
  else
  {
    WDTx->CR |=  (1 << WDT_CR_INTEN_Pos);
    
    WDTx->INTVAL = int_period;
    
    WDTx->IF = 1;
    NVIC_EnableIRQ(WDT_IRQn);
  }
  
  if(rst_period == 0)
  {
    WDTx->CR &= ~(1 << WDT_CR_RSTEN_Pos);
    
    WDTx->RSTVAL = int_period + 1;
  }
  else
  {
    WDTx->CR |=  (1 << WDT_CR_RSTEN_Pos);
    
    WDTx->RSTVAL = rst_period;
  }
}

/****************************************************************************************************************************************** 
* ���  ����:	WDT_Start()
* ���  ˵��:	����ָ��WDT����ʼ����ʱ
* ��    ��: WDT_TypeDe    * WDTx		ָ��Ҫ�����õĿ��Ź�����Чֵ����WDT
* ��    ��: ��
* ע������: ��
******************************************************************************************************************************************/
void WDT_Start(WDT_TypeDef * WDTx)
{
  WDTx->CR |=  (1 << WDT_CR_EN_Pos);
}

/****************************************************************************************************************************************** 
* ���  ����:	WDT_Stop()
* ���  ˵��:	�ر�ָ��WDT��ֹͣ����ʱ
* ��    ��: WDT_TypeDe    * WDTx		ָ��Ҫ�����õĿ��Ź�����Чֵ����WDT
* ��    ��: ��
* ע������: ��
******************************************************************************************************************************************/
void WDT_Stop(WDT_TypeDef * WDTx)
{
  WDTx->CR &= ~(1 << WDT_CR_EN_Pos);
}

/****************************************************************************************************************************************** 
* ���  ����:	WDT_Feed()
* ���  ˵��:	ι�������´�װ��ֵ��ʼ����ʱ
* ��    ��: WDT_TypeDe    * WDTx		ָ��Ҫ�����õĿ��Ź�����Чֵ����WDT
* ��    ��: ��
* ע������: ��
******************************************************************************************************************************************/
void WDT_Feed(WDT_TypeDef * WDTx)
{
  WDTx->FEED = 0x55;
}

/****************************************************************************************************************************************** 
* ���  ����:	WDT_INTClr()
* ���  ˵��:	�жϱ�־���
* ��    ��: WDT_TypeDe    * WDTx		ָ��Ҫ�����õĿ��Ź�����Чֵ����WDT
* ��    ��: ��
* ע������: ��
******************************************************************************************************************************************/
void WDT_INTClr(WDT_TypeDef * WDTx)
{
  WDTx->IF = 1;
}

/****************************************************************************************************************************************** 
* ���  ����:	WDT_INTStat()
* ���  ˵��:	�ж�״̬��ѯ
* ��    ��: WDT_TypeDe    * WDTx		ָ��Ҫ�����õĿ��Ź�����Чֵ����WDT
* ��    ��:          2_t					1 �����ж����    0 δ�����ж����
* ע������: ��
******************************************************************************************************************************************/
uint32_t WDT_INTStat(WDT_TypeDef * WDTx)
{
  return WDTx->IF;
}
